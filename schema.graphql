
# TODO: change to factory for clarity as creator is used for "artists/maker"?
type TokenContractCreator @entity {
  # TODO: the factory contract for zora NFT editions
  # NOTE: see here https://thegraph.com/docs/en/developer/create-subgraph-hosted/#data-source-templates
  # NOTE: there may be different ones but just olta's for now
  id: ID!
  tokenContracts: [TokenContract!] @derivedFrom(field: "tokenContractCreator")
}

type TokenContract @entity {
  # TODO: zora NFT edtitions - maybe one already exists?
  # NOTE: just id and creator for now while testing
  # editions, totalToMint, tokenContractFactory ... and so on

  "The address of the token contract"
  id: ID!

  "The id given by the tokenConractCreator"
  tokenContractId: BigInt!

  "The creator of the tokenContract"
  creator: User!

  "The total size of editions"
  editionSize: BigInt!

  "The contract that created this tokenContract"
  tokenContractCreator: TokenContractCreator!

  "The imageURL"
  imageURL: String!

  "The sha-256 hash of the content of imageURL"
  imageHash: String!

  "The animationURL"
  animationURL: String!

  "The sha-256 hash of the content of animationURL"
  animationHash: String!

  "The name of edition token"
  name: String!

  "The symbol of edition token"
  symbol: String!

  "The description of edition token"
  description: String!

  "The tokens minted"
  tokens: [Token!] @derivedFrom(field: "tokenContract")

  "The timestamp of the block the Purchase was created in"
  createdAtTimestamp: BigInt!

  "The number of the block the Purchase was created in"
  createdAtBlockNumber: BigInt!
}

type Token @entity {
  #TODO: add more (see zora's media entitiy) just added these values for now
  "<tokenContractAddress-editionNumber>"
  id: ID!

  "The edition number of the token"
  editionNumber: BigInt!

  "The token contract the token is derived from"
  tokenContract: TokenContract!

   "The current owner of the Media"
  owner: User!

  "The previous owner of the Zora Media's Market"
  prevOwner: User!

  "The Base64 encoded URI metadata of the token"
  tokenURI: String!

  "The timestamp of the block the Purchase was created in"
  createdAtTimestamp: BigInt!

  "The number of the block the Purchase was created in"
  createdAtBlockNumber: BigInt!
}

type Currency @entity {
  "The address of the Currency"
  id: ID!

  "The name of the Currency"
  name: String!

  "The symbol of the Currency"
  symbol: String!

  "The decimals of the Currency"
  decimals: Int

  "The purchases made with the Currency"
  previousPurchases: [Purchase!] @derivedFrom(field: "currency")
}

type User @entity {
  "Ethereum Address"
  id: ID!

  "Users that have been granted `ApprovalForAll` Media of the User's Collection"
  authorizedUsers: [User!]

  # "The Media the User owns"
  # collection: [Media!]! @derivedFrom(field: "owner")

  # "The Media the User created"
  # creations: [Media!]! @derivedFrom(field: "creator")

  "The active Bids made by the User"
  previousPurchases: [Purchase!] @derivedFrom(field: "collector")
}

enum PurchaseType {
  Refunded
  Final
}

type Purchase @entity {
  "<txHash>"
  id: ID!

  "The transaction hash the purchase was made at"
  transactionHash: String!

  "The token id purchased"
  token: Token!

  "The Editions auction associated with the Purchase"
  editionsAuction: EditionsAuction!

  "The amount of the Purchase"
  amount: BigInt!

  "The initiator of the Purchase"
  collector: User!

  "The type of purchase (Refunded, Final)"
  purchaseType: PurchaseType!

  "The Currency the purchase was made in"
  currency: Currency!

  "The timestamp of the block the Purchase was created in"
  createdAtTimestamp: BigInt!

  "The number of the block the Purchase was created in"
  createdAtBlockNumber: BigInt!
}

enum EditionsAuctionStatus {
  Pending
  Active
  Canceled
  Finished
}

type EditionsAuction @entity {
  "ID of the editions auction from contract, autoincrementing int"
  id: ID!

  "Transaction hash where the editions auction was created"
  transactionHash: String!

  "The originating token contract for this auction"
  tokenContract: TokenContract!

  "Whether or not the auction has been approved by the curator"
  approved: Boolean!

  "The length of time the auction is intended to run for, after the first bid is made"
  duration: BigInt!

  "The time the auction will start"
  startTimestamp: BigInt

  "The time the auction will reach it's end price"
  endTimestamp: BigInt

  "The price the auction starts at"
  startPrice: BigInt!

  "The price the auction ends at"
  endPrice: BigInt!

  "The sale percentage to send to the curator"
  curatorRoyaltyBPS: BigInt!

  "The address that created the editions and will recieve funds"
  creator: User!

  "The address of the auction's curator"
  curator: User!

  # "The address of the ERC-20 currency to run the auction with, or 0x0 for ETH"
  auctionCurrency: Currency!

  status: EditionsAuctionStatus!

  "The current bid on this auction"
  currentPrice: BigInt

  "The previous bids on this auction"
  previousPurchases: [Purchase!]  @derivedFrom(field: "editionsAuction")

  "The time the auction was approved"
  approvedTimestamp: BigInt

  "The number of the block the auction was Approved"
  approvedBlockNumber: BigInt

  "The timestamp of the block the Transfer was created in"
  createdAtTimestamp: BigInt!

  "The number of the block the Transfer was created in"
  createdAtBlockNumber: BigInt!

  "The timestamp at which the auction end function was called"
  finalizedAtTimestamp: BigInt

  "The block number at which the auction end function was called"
  finalizedAtBlockNumber: BigInt

}

